# サラオクDB プロジェクト仕様書

## 📋 プロジェクト概要

**サラオクDB**は、楽天サラブレッドオークションのデータをスクレイピングし、統計情報と馬の詳細情報を表示するWebアプリケーションです。

- **URL**: https://saraoku-db.vercel.app/
- **運用**: GitHub Actions + Vercel（完全無料）
- **目的**: 個人利用のオークション分析ツール

## 🏗️ システム構成

### フロントエンド
- **フレームワーク**: Next.js 15.3.5 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **デプロイ**: Vercel
- **ディレクトリ**: `static-frontend/`

### バックエンド
- **フレームワーク**: FastAPI
- **言語**: Python 3.11
- **データベース**: SQLite
- **ディレクトリ**: `backend/`

### データフロー
1. **スクレイピング**: 楽天オークション → SQLite DB
2. **データ変換**: SQLite → JSON (horses.json, horses_history.json)
3. **フロントエンド**: JSON → 静的サイト表示

## 📁 ディレクトリ構成

```
SaraokuDB/
├── .github/workflows/          # GitHub Actions自動化
│   ├── scrape.yml              # メインスクレイピング（木・日23:59）
│   ├── scrape-auction.yml      # オークション専用（木・日23:59）
│   └── scrape-jbis.yml         # 賞金更新（毎月1日03:00）
├── backend/                    # バックエンド（FastAPI）
│   ├── scrapers/               # スクレイピングモジュール
│   ├── services/               # ビジネスロジック
│   ├── scheduler/              # 自動実行スケジューラー
│   └── database/               # データベースモデル
├── static-frontend/            # フロントエンド（Next.js）
│   ├── src/app/                # ページコンポーネント
│   │   ├── page.tsx            # ホームページ
│   │   ├── horses/             # 馬一覧・詳細
│   │   └── dashboard/          # 解析ページ
│   ├── public/data/            # JSONデータファイル
│   └── components/             # UIコンポーネント
├── scripts/                    # スクレイピングスクリプト
└── data/                       # データベースファイル
```

## 🔄 自動化スケジュール

### オークションスクレイピング
- **木曜オークション**: 木曜日 23:59 (JST)
- **日曜オークション**: 日曜日 23:59 (JST)
- **実行**: GitHub Actions + バックエンドスケジューラー

### 賞金情報更新
- **頻度**: 毎月1日 02:00 (JST)
- **対象**: 全馬の最新賞金情報
- **ソース**: netkeiba.com

### データファイル更新
- `horses.json`: 基本馬データ
- `horses_history.json`: 履歴付き馬データ（フロントエンド使用）

## 📊 データ構造

### horses.json
```json
{
  "metadata": {
    "last_updated": "2025-07-20T06:02:08.038019",
    "total_horses": 35,
    "average_price": 1208571
  },
  "horses": [
    {
      "id": 1,
      "name": "イチジョウサクラ",
      "sex": "牝",
      "age": "3",
      "sold_price": 810000,
      "total_prize_start": 0.0,
      "total_prize_latest": 0.0,
      "disease_tags": "皮膚病",
      "sire": "シルバーステート",
      "dam": "ピュアゴシップ",
      "primary_image": "https://...",
      "auction_date": "2025-07-19"
    }
  ]
}
```

### horses_history.json
```json
{
  "horses": [
    {
      "id": 1,
      "history": [
        {
          "auction_date": "2025-07-19",
          "name": "イチジョウサクラ",
          "sold_price": 810000,
          "total_prize_start": 0.0
        }
      ],
      "sire": "シルバーステート",
      "dam": "ピュアゴシップ",
      "total_prize_latest": 0.0
    }
  ]
}
```

## 🎨 フロントエンド仕様

### ページ構成
1. **ホームページ** (`/`)
   - 統計サマリー
   - 成長率トップ10
   - 馬一覧（最新5頭）

2. **馬一覧ページ** (`/horses`)
   - 全馬の一覧表示
   - 検索・ソート機能
   - 成長率表示（0.0%形式で統一）

3. **馬詳細ページ** (`/horses/[id]`)
   - 個別馬の詳細情報
   - 履歴表示
   - 疾病タグ表示

4. **解析ページ** (`/dashboard`)
   - ROI分析
   - 価値馬分析
   - ソート機能

### UI/UX仕様
- **デザイン**: シンプル・モダン
- **レスポンシブ**: モバイル対応
- **色使い**: 青系メイン、グレー背景
- **タイトル**: `サラオクDB | [ページ名]`形式

## 🔧 技術仕様

### スクレイピング
- **楽天オークション**: BeautifulSoup + requests
- **netkeiba**: Selenium + ChromeDriver
- **エラーハンドリング**: 重複実行防止、ログ出力

### データ処理
- **疾病タグ抽出**: キーワードマッチング
- **成長率計算**: `((latest - start) / start * 100).toFixed(1)`
- **価格表示**: 円単位（カンマ区切り）
- **賞金表示**: 万円単位（小数点1桁）

### セキュリティ
- **検索エンジン登録**: 禁止（noindex, nofollow）
- **robots.txt**: 全クローラー禁止
- **API制限**: なし（静的サイト）

## 🚀 デプロイ・運用

### デプロイフロー
1. GitHubにプッシュ
2. GitHub Actions自動実行
3. Vercel自動デプロイ
4. 静的サイト生成

### 監視・ログ
- **GitHub Actions**: 実行ログ
- **Vercel**: デプロイログ
- **エラー通知**: なし（手動確認）

### バックアップ
- **データ**: GitHubリポジトリ内JSON
- **コード**: GitHubリポジトリ
- **設定**: 手動管理

## 🔄 更新・メンテナンス

### 定期メンテナンス
- **データ更新**: 自動（スケジュール通り）
- **コード更新**: 手動（必要時）
- **依存関係**: 手動（セキュリティ更新時）

### トラブルシューティング
1. **スクレイピング失敗**: サイト構造変更確認
2. **ビルドエラー**: TypeScript型エラー確認
3. **デプロイ失敗**: Vercel設定確認

## 📝 開発ガイドライン

### コーディング規約
- **TypeScript**: 厳密な型定義
- **React**: 関数コンポーネント + Hooks
- **命名**: 日本語（UI）、英語（コード）
- **コメント**: 日本語

### データ整合性
- **JSON形式**: 統一された構造
- **日付形式**: ISO 8601
- **数値**: 適切な型（number/string）

### パフォーマンス
- **静的生成**: Next.js SSG
- **画像最適化**: Next.js Image
- **バンドルサイズ**: 最小化

## 🎯 今後の拡張予定

### 機能追加候補
- 血統分析機能
- 価格予測機能
- データエクスポート機能
- 通知機能

### 技術改善候補
- データベース移行（PostgreSQL）
- リアルタイム更新
- PWA対応
- オフライン対応

---

**最終更新**: 2025-07-20
**バージョン**: 1.0.0
**管理者**: サラオクDB開発チーム 